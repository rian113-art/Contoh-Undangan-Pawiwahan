<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Undangan Mepandes – Cantika & Dekwah</title>
  <meta name="description" content="Undangan upacara Manusa Yadnya (Mepandes / Potong Gigi). Teriring doa dan welas asih, Om Swastyastu.">
  <meta property="og:title" content="Undangan Mepandes – Cantika & Dekwah" />
  <meta property="og:description" content="Ngaturang atur piuning, mugi rahayu. Klik untuk membuka undangan." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="cover.jpg" />
  <meta name="theme-color" content="#f7efe5" />

  <!-- Preconnect -->
  <link rel="preconnect" href="https://www.youtube.com">
  <link rel="preconnect" href="https://i.ytimg.com">

  <!-- Preload font (same-origin) -->
  <link rel="preload" as="font" href="font/SouthernAire_Personal_Use_Only.ttf?v=2" type="font/ttf">

  <style>
    /* ===== Custom font ===== */
    @font-face{
      font-family: 'SouthernAire';
      src:
        local('SouthernAire'),
        local('SouthernAire Personal Use Only'),
        url('font/SouthernAire_Personal_Use_Only.ttf?v=2') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --bg:#f7efe5;
      --ink:#2b2b2b;
      --accent:#ba7a2a;
      --accent-2:#e0b973;
      --card:#ffffffcc;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --lux-font: 'SouthernAire', ui-serif, Georgia, 'Times New Roman', serif;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}
    a{color:var(--accent);text-decoration:none}
    img{max-width:100%;display:block}

    /* Hero / Cover */
    .cover{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.55)), url('cover.jpg') center/cover no-repeat;z-index:50;color:#fff}
    .cover-inner{max-width:680px;text-align:center;padding:24px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #ffffff33;padding:6px 12px;border-radius:999px;font-size:14px;background:#ffffff1a;backdrop-filter: blur(6px)}
    .title{
      font-family: var(--lux-font);
      font-size: clamp(46px, 11vw, 96px);
      line-height: 1;
      margin: 6px 0 2px;
      font-weight: 400;
      letter-spacing: .2px;
    }
    .subtitle{opacity:.9;font-size:clamp(14px,2.5vw,18px)}
    .open-btn{margin-top:14px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;border:none;border-radius:14px;padding:14px 22px;font-size:16px;cursor:pointer;box-shadow:var(--shadow);transition:.25s transform}
    .open-btn:hover{transform:translateY(-2px)}

    /* Layout */
    .wrap{max-width:1080px;margin:0 auto;padding:24px}
    .card{background:var(--card);backdrop-filter: blur(8px);border:1px solid #00000010;border-radius:20px;box-shadow:var(--shadow);padding:22px}
    .grid{display:grid;gap:18px}
    @media(min-width:900px){.grid-2{grid-template-columns:1.2fr .8fr}}

    header.hero{padding-top:72px}
    .names{
      font-family: var(--lux-font);
      font-size: clamp(34px, 9vw, 68px);
      font-weight: 400;
      text-align:center;
      line-height: 1.02;
      letter-spacing: .2px;
    }
    .date{color:#444;text-align:center;margin-top:6px}

    /* Countdown */
    .countdown{display:grid;grid-auto-flow:column;gap:10px;justify-content:center;margin:18px 0}
    .cell{background:#fff;border-radius:14px;padding:10px 14px;border:1px solid #00000014;min-width:68px;text-align:center}
    .cell .num{font-size:28px;font-weight:800}
    .cell .lbl{font-size:12px;color:#666}

    /* Sections */
    section{margin:26px 0}
    h2{font-size:clamp(20px,4vw,28px);margin:6px 0 12px}

    /* Info list */
    .info{display:grid;gap:10px}
    .info .row{display:flex;gap:12px;align-items:flex-start}
    .icon{width:24px;height:24px;flex:0 0 24px;opacity:.9}

    /* Map */
    .map{border-radius:16px;overflow:hidden;border:1px solid #00000018}
    .map iframe{width:100%;height:300px;border:0}

    /* Galeri — font custom + center */
    #sectionGallery > h2{
      text-align: center;
      font-family: var(--lux-font);
      font-weight: 400;
      font-size: clamp(26px, 7.5vw, 40px);
      line-height: 1;
      margin: 6px 0 12px;
    }
    /* Potret Mempelai — font custom */
    #portraits > h2{
      font-family: var(--lux-font);
      font-weight: 400;
      font-size: clamp(26px, 7.5vw, 40px);
      line-height: 1;
      margin: 6px 0 12px;
    }

    /* Gallery grid */
    .gallery{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(min-width:720px){.gallery{grid-template-columns:repeat(4,1fr)}}
    .gallery img{border-radius:14px;aspect-ratio:1/1;object-fit:cover;border:1px solid #00000018;cursor:pointer}

    /* Lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:60}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:84vh;border-radius:12px}
    .lb-nav{position:fixed;inset:0;display:flex;align-items:center;justify-content:space-between;padding:24px;color:#fff}
    .lb-btn{background:#ffffff1a;border:1px solid #ffffff33;border-radius:12px;padding:10px 14px;cursor:pointer}

    /* Forms */
    form .field{display:grid;gap:6px;margin:10px 0}
    input, select, textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #00000022;background:#fff;font-size:14px}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#fff;padding:12px 16px;border-radius:14px;font-weight:700;cursor:pointer}
    .notes{font-size:12px;color:#666}

    .guestbook .item{background:#fff;border:1px solid #00000014;border-radius:14px;padding:12px;display:grid;gap:4px}
    .guestbook .meta{font-size:12px;color:#666}

    /* Floating FABs */
    .fab-col{position:fixed;right:16px;bottom:16px;display:grid;gap:10px;z-index:40}
    .fab{display:inline-grid;place-items:center;width:54px;height:54px;border-radius:999px;background:#fff;border:1px solid #00000022;box-shadow:var(--shadow);cursor:pointer}

    /* Reveal on scroll (lembut) */
    .reveal{opacity:0;transform:translateY(18px) scale(.98);transition:opacity .65s ease, transform .65s cubic-bezier(.22,.8,.24,1)}
    .reveal.show{opacity:1;transform:none}

    footer{padding:30px 0 60px;text-align:center;color:#666}
    .badge{display:inline-block;background:#fff;border:1px solid #00000014;border-radius:10px;padding:6px 10px;font-size:12px}

    /* Sponsor (multi, vertikal) */
    .sponsor{margin-top:14px;display:flex;flex-direction:column;align-items:center;gap:10px;color:#666}
    .sponsor-heading{font-size:12px}
    .sponsor-logos{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));
      gap:14px; width:100%; max-width:520px; justify-items:center;
    }
    .sponsor-item{display:flex;flex-direction:column;align-items:center;text-align:center}
    .sponsor-item img{height:34px;width:auto;opacity:.95}
    .sponsor-item .cap{font-size:11px;color:#888;margin-top:6px}

    /* === Portraits (dua foto – stadium vertikal) === */
    .portraits .grid-portraits{
      display:grid;
      gap:28px;
      grid-template-columns:1fr;
    }
    @media(min-width:720px){
      .portraits .grid-portraits{
        grid-template-columns:1fr 1fr;
        column-gap:40px;
        row-gap:28px;
      }
    }
    .portrait-card{ display:grid; justify-items:center; gap:10px; text-align:center; }
    .portrait-frame{
      width:clamp(200px,48vw,320px);
      aspect-ratio:3/4;
      padding:2px;
      border:2px solid #d4af37;
      border-radius:9999px;
      overflow:hidden;
      background:#fff;
      box-shadow:var(--shadow);
    }
    .portrait-img{ width:100%; height:100%; object-fit:cover; border-radius:inherit; display:block; background:#00000008; }

    .portrait-name{
      font-family: var(--lux-font) !important;
      font-weight: 400;
      font-size: clamp(22px, 7vw, 34px);
      line-height: 1.03;
    }
    .portrait-sub{ font-size:12px; color:#666; }

    .footer-title{
      font-family: var(--lux-font);
      font-weight: 400;
      font-size: clamp(28px, 8.5vw, 48px);
      line-height: 1.02;
    }
    .footer-sub{ font-size:14px; color:#666; }

    /* ======== Gift Modal (Beri Hadiah) ======== */
    .gift-wrap{display:flex;justify-content:center}
    .gift-btn{
      display:inline-flex;align-items:center;gap:8px;
      background:#fff;border:1px solid #00000022;border-radius:14px;
      padding:12px 16px;cursor:pointer;box-shadow:var(--shadow);font-weight:700
    }

    .gift-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;z-index:70}
    .gift-modal.open{display:flex}
    .gift-pane{
      width:min(740px,92vw);background:var(--card);border:1px solid #00000018;border-radius:20px;box-shadow:var(--shadow);
      padding:16px;opacity:0;transform:translateY(12px) scale(.98);transition:.35s
    }
    .gift-modal.open .gift-pane{opacity:1;transform:none}
    .gift-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .gift-title{font-weight:800}
    .gift-close{background:#ffffff1a;border:1px solid #00000022;border-radius:12px;padding:8px 10px;cursor:pointer}

    .gift-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .gift-card{
      background:#fff;border:1px solid #00000014;border-radius:16px;padding:14px;position:relative;overflow:hidden
    }
    .gift-card::before{content:"";position:absolute;left:0;right:0;bottom:0;height:6px;background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    .gift-bank{font-weight:800;letter-spacing:.5px;margin-bottom:6px}
    .gift-acc{font-size:18px;font-weight:800}
    .gift-name{font-size:12px;color:#666}
    .gift-actions{margin-top:10px;display:flex;gap:8px}
    .copy-btn,.open-wa{
      background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#fff;
      padding:10px 12px;border-radius:12px;font-weight:700;cursor:pointer
    }
    .open-wa{background:#fff;border:1px solid #00000022;color:#333}
    .copy-done{font-size:12px;color:#3a7e3a;margin-left:6px}

    /* ======== Timeline Runtutan Acara (tanpa font custom) ======== */
    #rundown > h2{
      text-align:center;
      margin-bottom:14px;
    }
    .timeline{
      position:relative;
      list-style:none;
      margin:0;
      padding-left:26px; /* ruang untuk garis vertikal */
    }
    .timeline::before{
      content:"";
      position:absolute; left:13px; top:0; bottom:0;
      width:2px; background: #e0b97355; /* garis vertikal */
    }
    .timeline li{
      position:relative;
      background:#fff;
      border:1px solid #00000014;
      border-radius:14px;
      padding:12px 14px;
      margin:0 0 14px 0;
      box-shadow:var(--shadow);
    }
    /* titik harus tepat di garis vertikal (garis di 13px dari sisi kiri container) */
    .timeline li::before{
      content:"";
      position:absolute;
      /* total diameter titik = 12 + border(2*2) = 16 => set kiri = -13 - 8 = -21 */
      left:-21px;
      top:22px;
      width:12px; height:12px; border-radius:999px;
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      border:2px solid #fff; box-shadow:0 0 0 2px #e9dfcc;
    }
    .timeline .tl-date{font-weight:800; font-size:14px; letter-spacing:.2px}
    .timeline .tl-title{font-weight:700; margin-top:6px}
    .timeline .tl-desc{font-size:13px; color:#555; margin-top:4px; line-height:1.45}
  </style>
</head>
<body>
<script>
  const CONFIG = {
    title: "Contoh Undangan Pawiwahan",
    bride: "I Luh Wangi",
    groom: "Putu Erik Sudiastika",
    parents: "Matur suksma ring sami sane prasida rawuh sareng nyaksenin upacara pawiwahan puniki, serta terima kasih atas doa restu yang diberikan",
    dateISO: "2025-09-29T17:00:00+08:00",
    dateText: "Senin, 29 September 2025 • 17.00 WITA – 19.00",
    place: "Dusun Ujung Sari, Desa Subur, Lr.2B",
    maps: "https://maps.app.goo.gl/S7hWjjKRmhS3vkGo6",
    whatsapp: "6287789154894",
    coverImage: "cover.jpg",

    gallery: ["foto1.jpg","foto2.jpg","foto3.jpg","foto4.jpg","foto5.jpg"],

    youtube: "https://youtu.be/L2I7hZqC7lY?si=yAiNTx3aji-g6nfD",
    sponsorsHeading: "support by:",
    sponsors: [
      { logo: "sponsor1.png", name: "Super Grup", link: "" },
      { logo: "sponsor2.png", name: "Yaatra Studio", link: "" }
    ],
    portraits: {
      bride: { src: "potret-wanita.jpg", name: "I Luh Wangi",   sub: "Putri pertama dari Pasangan Kadek Budi Asih & I Wayan Puguh" },
      groom: { src: "potret-pria.jpg",   name: "Putu Erik Sudiastika", sub: "Putra pertama dari Pasangan Komang Astini & I Wayan Budiasta" }
    },

    /* 2 item sesuai permintaan */
    rundown: [
      {
        date: "23 September 2025",
        title: "Ngidih",
        desc: "upacara lamaran, pihak purusa ngaturangang idih ring pihak pradana."
      },
      {
        date: "29 September 2025",
        title: "Resepsi Pawiwahan",
        desc: "acara resepsi pernikahan, ngaturangang pangastuti/terima kasih ring sami tamu undangan sane rawuh."
      }
    ],

    /* Gift */
    gifts: [
      { bank: "BRI", acc: "901378610220", name: "I Luh Wangi" },
      { bank: "E-Wallet DANA", acc: "xxxxxx", name: "xxxxxx" }
    ]
  };
  document.title = CONFIG.title;
</script>

  <!-- COVER -->
  <div class="cover" id="cover">
    <div class="cover-inner">
      <div class="chip">Om Swastyastu • Manusa Yadnya</div>
      <div class="title">Pawiwahan / Pernikahan Erik & Wangi</div>
      <p class="subtitle">Ngaturang atur piuning, mugi rahayu. Klik tombol di bawah untuk membuka undangan.</p>
      <button class="open-btn" id="openInvite">Buka Undangan</button>
    </div>
  </div>

  <main class="wrap" id="app" style="display:none">
    <header class="hero reveal">
      <div class="card">
        <div class="names">{{BRIDE}} &amp; {{GROOM}}</div>
        <div class="date">{{PARENTS}}</div>
        <div class="countdown" id="countdown" aria-live="polite"></div>
        <p class="badge">{{DATETEXT}} • {{PLACE}}</p>
      </div>
    </header>

    <!-- POTRET MEMPELAI -->
    <section class="card reveal portraits" id="portraits">
      <h2>Potret Mempelai</h2>
      <div class="grid-portraits">
        <figure class="portrait-card">
          <div class="portrait-frame">
            <img id="portBride" class="portrait-img" alt="Potret mempelai wanita" />
          </div>
          <figcaption>
            <div class="portrait-name" id="portBrideName"></div>
            <div class="portrait-sub" id="portBrideSub"></div>
          </figcaption>
        </figure>
        <figure class="portrait-card">
          <div class="portrait-frame">
            <img id="portGroom" class="portrait-img" alt="Potret mempelai pria" />
          </div>
          <figcaption>
            <div class="portrait-name" id="portGroomName"></div>
            <div class="portrait-sub" id="portGroomSub"></div>
          </figcaption>
        </figure>
      </div>
    </section>

    <!-- GALERI -->
    <section class="card reveal" id="sectionGallery">
      <h2>Galeri</h2>
      <div class="gallery" id="gallery"></div>
    </section>

    <!-- RUNTUTAN ACARA (tanpa font custom, titik sejajar garis) -->
    <section class="card reveal" id="rundown">
      <h2>Runtutan Acara Pawiwahan</h2>
      <ol class="timeline" id="rundownList"></ol>
    </section>

    <!-- WAKTU & TEMPAT -->
    <section class="reveal">
      <div class="card">
        <h2>Waktu & Tempat</h2>
        <div class="info">
          <div class="row">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg>
            <div><strong>Waktu</strong><div id="dateText">{{DATETEXT}}</div></div>
          </div>
          <div class="row">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 21s-7-5.2-7-10.2A7 7 0 0 1 19 10.8C19 15.8 12 21 12 21Z"/></svg>
            <div><strong>Lokasi</strong><div id="placeText"></div></div>
          </div>
          <div class="row">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
            <div>
              <strong>Tambahkan ke Kalender</strong>
              <div class="notes">Simpan pengingat ke kalender Anda (ICS).</div>
              <button class="primary" id="btnICS">Download .ics</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- MAP -->
    <section class="card reveal map">
      <iframe id="mapFrame" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div style="padding:10px 4px"><a id="mapLink" target="_blank" rel="noopener">Buka di Google Maps</a></div>
    </section>

    <!-- RSVP & BUKU TAMU -->
    <section class="grid grid-2">
      <div class="card reveal">
        <h2>Konfirmasi Kehadiran</h2>
        <form id="rsvp">
          <div class="field"><label>Nama</label><input required name="name" placeholder="Nama lengkap" /></div>
          <div class="field"><label>Status Kehadiran</label>
            <select name="status"><option value="Hadir">Hadir</option><option value="Tidak dapat hadir">Tidak dapat hadir</option></select>
          </div>
          <div class="field"><label>Jumlah Tamu</label><input type="number" name="count" value="1" min="1" /></div>
          <div class="field"><label>Ucapan (opsional)</label><textarea name="msg" rows="3" placeholder="Doa/ucapan singkat"></textarea></div>
          <button class="primary" type="submit">Kirim via WhatsApp</button>
          <p class="notes">Tombol akan membuka WhatsApp dengan format pesan otomatis.</p>
        </form>
      </div>
      <div class="card reveal">
        <h2>Buku Tamu</h2>
        <form id="guestForm">
          <div class="field"><label>Nama</label><input required name="n" placeholder="Nama"/></div>
          <div class="field"><label>Pesan</label><textarea required name="p" rows="3" placeholder="Tulis doa/ucapan"></textarea></div>
          <button class="primary" type="submit">Kirim</button>
        </form>
        <div class="notes" style="margin-top:8px">Disimpan secara lokal di perangkat Anda.</div>
        <div class="grid" style="margin-top:12px" id="guestList"></div>
      </div>
    </section>

    <!-- BERi HADIAH (di bawah Buku Tamu) -->
    <section class="reveal">
      <div class="card gift-wrap">
        <button class="gift-btn" id="btnGift">🎁 Beri Hadiah</button>
      </div>
    </section>

    <section class="card reveal">
      <h2>Protokol & Catatan</h2>
      <ul>
        <li>Mohon datang tepat waktu sesuai jadwal upacara.</li>
        <li>Jaga ketertiban dan tetap menghormati jalannya upacara.</li>
        <li>Parkir kendaraan pada area yang telah disediakan.</li>
      </ul>
    </section>

    <footer class="reveal">
      <div class="footer-title">Matur Suksma</div>
      <div class="footer-sub">Atas doa dan kehadiran semeton sami.</div>

      <div class="sponsor" id="sponsorBlock">
        <div class="sponsor-heading" id="sponsorHeading"></div>
        <div class="sponsor-logos" id="sponsorLogos"></div>
      </div>
    </footer>
  </main>

  <!-- GIFT MODAL -->
  <div class="gift-modal" id="giftModal" aria-modal="true" role="dialog">
    <div class="gift-pane" role="document">
      <div class="gift-head">
        <div class="gift-title">Beri Hadiah</div>
        <button class="gift-close" id="giftClose" aria-label="Tutup">✕</button>
      </div>
      <div class="gift-cards" id="giftCards"><!-- filled by JS --></div>
      <div class="notes" style="margin-top:10px">Matur suksma ring Ida Dane sami sane sampun ngaturang dukungan miwah pangastuti 🙏</div>
    </div>
  </div>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <div class="lb-nav">
      <button class="lb-btn" id="lbPrev" aria-label="Sebelumnya">◀</button>
      <button class="lb-btn" id="lbClose" aria-label="Tutup">✕</button>
      <button class="lb-btn" id="lbNext" aria-label="Berikutnya">▶</button>
    </div>
    <img id="lbImg" alt="Foto galeri" />
  </div>

  <!-- FABs -->
  <div class="fab-col" id="fabs" style="display:none">
    <button class="fab" id="btnMusic" aria-label="Musik latar">
      <svg id="iconPlay" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      <svg id="iconPause" viewBox="0 0 24 24" width="22" height="22" fill="currentColor" style="display:none"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>
    </button>
    <button class="fab" id="btnShare" aria-label="Bagikan">🔗</button>
  </div>

  <!-- Fallback audio -->
  <audio id="bgm" loop preload="none"><source src="musik.mp3" type="audio/mpeg" /></audio>

  <!-- YT hidden -->
  <div id="ytWrap" aria-hidden="true" style="position:fixed;left:-9999px;top:auto;width:1px;height:1px;opacity:0;pointer-events:none">
    <div id="ytPlayer"></div>
  </div>

  <script>
    const byId = (id)=>document.getElementById(id);
    const $$ = (sel,root=document)=>[...root.querySelectorAll(sel)];

    // Inject hero
    const hero = document.querySelector('header.hero .card');
    hero.innerHTML = hero.innerHTML
      .replaceAll('{{BRIDE}}', CONFIG.bride)
      .replaceAll('{{GROOM}}', CONFIG.groom)
      .replaceAll('{{PARENTS}}', CONFIG.parents)
      .replaceAll('{{DATETEXT}}', CONFIG.dateText)
      .replaceAll('{{PLACE}}', CONFIG.place);

    byId('dateText').textContent = CONFIG.dateText;
    const placeEl = byId('placeText'); if (placeEl) placeEl.textContent = CONFIG.place;

    // ==== Portraits inject ====
    (function(){
      const P = CONFIG.portraits || {};
      const s1 = P.bride?.src, s2 = P.groom?.src;
      const sec = byId('portraits');
      if(!s1 && !s2){ sec.style.display='none'; return; }

      if(s1){ byId('portBride').src = s1; }
      if(s2){ byId('portGroom').src = s2; }
      byId('portBrideName').textContent = P.bride?.name || CONFIG.bride;
      byId('portGroomName').textContent = P.groom?.name || CONFIG.groom;
      byId('portBrideSub').textContent  = P.bride?.sub || "";
      byId('portGroomSub').textContent  = P.groom?.sub || "";
    })();

    // ===== Sponsor block =====
    (function(){
      const headingEl = byId('sponsorHeading');
      const logosWrap = byId('sponsorLogos');
      const block     = byId('sponsorBlock');
      const list = Array.isArray(CONFIG.sponsors) ? CONFIG.sponsors : [];
      const hasAnything = (list.length > 0) || (CONFIG.sponsorsHeading && CONFIG.sponsorsHeading.trim() !== "");
      if (!hasAnything) { block.style.display = 'none'; return; }
      headingEl.textContent = CONFIG.sponsorsHeading || 'sponsored by:';
      list.forEach(it=>{
        if(!it || !it.logo) return;
        const item = document.createElement('div');
        item.className = 'sponsor-item';
        const img = document.createElement('img');
        img.alt = it.name || 'Sponsor'; img.src = it.logo; img.onerror = ()=>{ item.style.display='none'; };
        if (it.link) { const a=document.createElement('a'); a.href=it.link; a.target='_blank'; a.rel='noopener'; a.appendChild(img); item.appendChild(a); }
        else { item.appendChild(img); }
        if (it.name) { const cap=document.createElement('div'); cap.className='cap'; cap.textContent=it.name; item.appendChild(cap); }
        logosWrap.appendChild(item);
      });
    })();

    // Map embed
    const mapUrl = CONFIG.maps || "";
    const embed = (u)=>{
      try{
        if(u.includes("/embed")) return u;
        if(u.includes("maps.app.goo.gl") || u.trim()===""){ return "https://www.google.com/maps?q="+encodeURIComponent(CONFIG.place)+"&output=embed"; }
        if(u.includes("/@")) return u.replace("/@","/embed?pb=");
      }catch{}
      return "https://www.google.com/maps?q="+encodeURIComponent(CONFIG.place)+"&output=embed";
    };
    byId('mapFrame').src = embed(mapUrl);
    const mapLink = document.getElementById('mapLink');
    mapLink.href = mapUrl || ("https://www.google.com/maps?q="+encodeURIComponent(CONFIG.place));
    mapLink.textContent = CONFIG.place + ' — Lihat di Maps';

    // === Galeri build
    (function(){
      const g = byId('gallery');
      const arr = Array.isArray(CONFIG.gallery) ? CONFIG.gallery : [];
      if(!g || arr.length === 0){ return; }
      g.innerHTML = '';
      arr.forEach((src,i)=>{
        const img=document.createElement('img');
        img.src=src; img.alt='Galeri '+(i+1); img.loading='lazy';
        img.addEventListener('click',()=>openLightbox(i));
        g.appendChild(img);
      });
    })();

    // === Runtutan Acara build (pakai kelas tl-* agar tidak bentrok font custom) ===
    (function(){
      const data = Array.isArray(CONFIG.rundown) ? CONFIG.rundown : [];
      const list = byId('rundownList');
      if(!list || data.length===0) return;
      list.innerHTML = '';
      data.forEach(it=>{
        const li = document.createElement('li');
        li.innerHTML = `
          <div class="tl-date">${escapeHTML(it.date||'')}</div>
          <div class="tl-title">${escapeHTML(it.title||'')}</div>
          <div class="tl-desc">${escapeHTML(it.desc||'')}</div>
        `;
        list.appendChild(li);
      });
    })();

    /* ===== Scroll reveal ===== */
    function setupScrollReveal(){
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            e.target.classList.add('show');
            io.unobserve(e.target);
          }
        });
      }, { threshold: 0.15, rootMargin: '0px 0px -5% 0px' });
      document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
    }

    // Open / Cover
    const cover = byId('cover'), app = byId('app'), fabs = byId('fabs');

    // YT support
    function getYTId(input){ if(!input) return ""; const s=String(input).trim(); const m=s.match(/(?:v=|\.be\/|embed\/)([a-zA-Z0-9_-]{11})/); return m?.[1] || (/^[a-zA-Z0-9_-]{11}$/.test(s)?s:""); }
    const YT_ID = getYTId(CONFIG.youtube); const USE_YT = !!YT_ID;
    let ytPlayer=null, pendingPlay=false;
    window.onYouTubeIframeAPIReady = function(){
      if(!USE_YT) return;
      ytPlayer = new YT.Player('ytPlayer',{ videoId:YT_ID, playerVars:{autoplay:0,loop:1,playlist:YT_ID,controls:0,modestbranding:1,rel:0,fs:0,playsinline:1},
        events:{ onReady:()=>{ if(pendingPlay){ try{ytPlayer.playVideo();}catch{} pendingPlay=false; syncMusicBtn(); } } }});
    };

    const bgm = document.getElementById('bgm');
    const iconPlay = document.getElementById('iconPlay');
    const iconPause= document.getElementById('iconPause');
    function isMusicPlaying(){ return (USE_YT && ytPlayer?.getPlayerState)? (ytPlayer.getPlayerState()===YT.PlayerState.PLAYING) : !bgm.paused; }
    function syncMusicBtn(){ const p=isMusicPlaying(); iconPlay.style.display=p?'none':'block'; iconPause.style.display=p?'block':'none'; }

    document.getElementById('openInvite').addEventListener('click', ()=>{
      cover.style.display='none'; app.style.display='block'; fabs.style.display='grid';
      setupScrollReveal();
      startCountdown();
      if (USE_YT){ if(ytPlayer?.playVideo){ try{ytPlayer.playVideo();}catch{} } else { pendingPlay=true; } try{bgm.pause();}catch{} }
      else { try{bgm.play().then(()=>syncMusicBtn());}catch{} }
      syncMusicBtn();
    });

    document.getElementById('btnMusic').addEventListener('click', ()=>{
      if (USE_YT){ const st=ytPlayer?.getPlayerState?.(); if(st===YT.PlayerState.PLAYING) ytPlayer.pauseVideo(); else ytPlayer?.playVideo() ?? (pendingPlay=true); }
      else { if (bgm.paused) bgm.play(); else bgm.pause(); }
      syncMusicBtn();
    });

    // ===== Gift modal logic =====
    const giftModal = byId('giftModal');
    const btnGift = byId('btnGift');
    const giftClose = byId('giftClose');
    btnGift?.addEventListener('click', ()=> giftModal.classList.add('open'));
    giftClose?.addEventListener('click', ()=> giftModal.classList.remove('open'));
    giftModal?.addEventListener('click', (e)=>{ if(e.target===giftModal) giftModal.classList.remove('open'); });

    // Build gift cards from CONFIG
    (function(){
      const data = Array.isArray(CONFIG.gifts) ? CONFIG.gifts : [];
      const wrap = byId('giftCards');
      if (!wrap || data.length===0) return;
      wrap.innerHTML = '';
      data.forEach((it)=>{
        const div = document.createElement('div');
        div.className = 'gift-card';
        const bank = (it.bank||'BANK').toUpperCase();
        const acc  = String(it.acc||'');
        const name = it.name||'';
        div.innerHTML = `
          <div class="gift-bank">${bank}</div>
          <div class="gift-acc" data-acc="${acc}">${acc}</div>
          <div class="gift-name">a.n. ${name}</div>
          <div class="gift-actions">
            <button class="copy-btn" data-copy="${acc}">Salin No. Rekening</button>
            <button class="open-wa" data-wa="${acc}" data-bank="${bank}">Kirim via WA</button>
          </div>
          <div class="copy-done" style="display:none">Disalin ✓</div>
        `;
        wrap.appendChild(div);
      });
    })();

    // Copy buttons + open WA
    byId('giftCards')?.addEventListener('click', async (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      if(btn.classList.contains('copy-btn')){
        const text = btn.dataset.copy||'';
        try{
          await navigator.clipboard.writeText(text);
          const info = btn.parentElement.nextElementSibling;
          if(info){ info.style.display='inline'; setTimeout(()=>info.style.display='none', 1400); }
        }catch{}
      }
      if(btn.classList.contains('open-wa')){
        const acc = btn.dataset.wa||'';
        const bank= btn.dataset.bank||'';
        const msg = `Halo, saya ingin mengirim hadiah.\nBank: ${bank}\nNo. Rekening: ${acc}\nTerima kasih.`;
        window.open(`https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
      }
    });

    // Countdown
    let timerId=null;
    function startCountdown(){
      const box=document.getElementById('countdown'); const t=new Date(CONFIG.dateISO).getTime();
      const labels=['Hari','Jam','Menit','Detik']; const cell=(v,l)=>`<div class="cell"><div class="num">${v}</div><div class="lbl">${l}</div></div>`;
      function tick(){ const now=Date.now(); let diff=Math.max(0,t-now); const d=Math.floor(diff/86400000); diff-=d*86400000; const h=Math.floor(diff/3600000); diff-=h*3600000; const m=Math.floor(diff/60000); diff-=m*60000; const s=Math.floor(diff/1000); box.innerHTML=[d,h,m,s].map((n,i)=>cell(String(n).padStart(2,'0'),labels[i])).join(''); }
      tick(); clearInterval(timerId); timerId=setInterval(tick,1000);
    }

    // Lightbox (galeri)
    const lb=document.getElementById('lightbox'), lbImg=document.getElementById('lbImg'); let lbIndex=0;
    function openLightbox(i){ lbIndex=i; updateLB(); lb.classList.add('open'); }
    function closeLightbox(){ lb.classList.remove('open'); }
    function updateLB(){ lbImg.src=CONFIG.gallery[lbIndex]; }
    document.getElementById('lbPrev').onclick=()=>{ lbIndex=(lbIndex-1+CONFIG.gallery.length)%CONFIG.gallery.length; updateLB(); };
    document.getElementById('lbNext').onclick=()=>{ lbIndex=(lbIndex+1)%CONFIG.gallery.length; updateLB(); };
    document.getElementById('lbClose').onclick=closeLightbox;
    lb.addEventListener('click', e=>{ if(e.target===lb) closeLightbox(); });
    window.addEventListener('keydown', e=>{
      if(!lb.classList.contains('open')) return;
      if(e.key==='Escape') closeLightbox();
      if(e.key==='ArrowRight') document.getElementById('lbNext').click();
      if(e.key==='ArrowLeft') document.getElementById('lbPrev').click();
    });

    // Guestbook (local)
    const LS_KEY='guestbook-mepandes'; const list=document.getElementById('guestList'); const entries=JSON.parse(localStorage.getItem(LS_KEY)||'[]');
    function renderGuest(){ list.innerHTML=''; entries.sort((a,b)=>b.t-a.t).forEach(it=>{ const d=document.createElement('div'); d.className='guestbook item'; d.innerHTML=`<div><strong>${escapeHTML(it.n)}</strong></div><div>${escapeHTML(it.p)}</div><div class='meta'>${new Date(it.t).toLocaleString('id-ID')}</div>`; list.appendChild(d); }); }
    renderGuest();
    document.getElementById('guestForm').addEventListener('submit', e=>{
      e.preventDefault(); const f=new FormData(e.target); const n=(f.get('n')||'').trim(); const p=(f.get('p')||'').trim(); if(!n||!p) return;
      entries.push({n,p,t:Date.now()}); localStorage.setItem(LS_KEY, JSON.stringify(entries)); e.target.reset(); renderGuest();
    });
    function escapeHTML(s){ return String(s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

    // Share
    document.getElementById('btnShare').addEventListener('click', async ()=>{
      const shareData={title:CONFIG.title, text:`Undangan: ${CONFIG.bride} & ${CONFIG.groom} – ${CONFIG.dateText}`, url:location.href};
      if(navigator.share){ try{ await navigator.share(shareData);}catch{} } else { await navigator.clipboard.writeText(shareData.url); alert('Link disalin ke clipboard'); }
    });

    // ICS
    document.getElementById('btnICS').addEventListener('click', ()=>{
      const dt=new Date(CONFIG.dateISO); const dtStart=toICSDate(dt); const dtEnd=toICSDate(new Date(dt.getTime()+3*60*60*1000));
      const ics=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Undangan Mepandes//ID
CALSCALE:GREGORIAN
BEGIN:VEVENT
DTSTAMP:${toICSDate(new Date())}
UID:${crypto.randomUUID()}
DTSTART:${dtStart}
DTEND:${dtEnd}
SUMMARY:Upacara Pawiwahan – ${CONFIG.bride} & ${CONFIG.groom}
LOCATION:${escapeICS(CONFIG.place)}
DESCRIPTION:${escapeICS('Undangan Pawiwahan. Info: '+CONFIG.place)}
END:VEVENT
END:VCALENDAR`;
      const blob=new Blob([ics],{type:'text/calendar'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='undangan.ics'; a.click(); URL.revokeObjectURL(a.href);
    });
    function toICSDate(d){ const pad=n=>String(n).padStart(2,'0'); return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+'Z'; }
    function escapeICS(s){ return String(s||'').replace(/\\/g,'\\\\').replace(/;/g,'\\;').replace(/,/g,'\\,').replace(/\n/g,'\\n'); }
  </script>

  <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>

