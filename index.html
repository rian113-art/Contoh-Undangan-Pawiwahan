<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Undangan Mepandes â€“ Cantika & Dekwah</title>
  <meta name="description" content="Undangan upacara Manusa Yadnya (Mepandes / Potong Gigi). Teriring doa dan welas asih, Om Swastyastu.">
  <meta property="og:title" content="Undangan Mepandes â€“ Cantika & Dekwah" />
  <meta property="og:description" content="Ngaturang atur piuning, mugi rahayu. Klik untuk membuka undangan." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="cover.jpg" />
  <meta name="theme-color" content="#f7efe5" />

  <!-- YouTube preconnect -->
  <link rel="preconnect" href="https://www.youtube.com">
  <link rel="preconnect" href="https://i.ytimg.com">

  <!-- Preload & declare custom font -->
  <link rel="preload" as="font" href="font/SouthernAire_Personal_Use_Only.ttf" type="font/ttf" crossorigin>
  <style>
    /* ===== Custom font ===== */
    @font-face{
      font-family: 'SouthernAire';
      src: url('font/SouthernAire_Personal_Use_Only.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --bg:#f7efe5;
      --ink:#2b2b2b;
      --accent:#ba7a2a;
      --accent-2:#e0b973;
      --card:#ffffffcc;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      /* Pakai font custom untuk judul cover */
      --lux-font: 'SouthernAire', ui-serif, Georgia, 'Times New Roman', serif;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}
    a{color:var(--accent);text-decoration:none}
    img{max-width:100%;display:block}

    /* Hero / Cover */
    .cover{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.55)), url('cover.jpg') center/cover no-repeat;z-index:50;color:#fff}
    .cover-inner{max-width:680px;text-align:center;padding:24px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #ffffff33;padding:6px 12px;border-radius:999px;font-size:14px;background:#ffffff1a;backdrop-filter: blur(6px)}
    .title{
      font-family: var(--lux-font);   /* <- font custom di sini */
      font-size:clamp(28px,6vw,56px);
      line-height:1.05;
      margin:16px 0 8px;
      font-weight:400;
      letter-spacing:.3px;
    }
    .subtitle{opacity:.9;font-size:clamp(14px,2.5vw,18px)}
    .open-btn{margin-top:22px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;border:none;border-radius:14px;padding:14px 22px;font-size:16px;cursor:pointer;box-shadow:var(--shadow);transition:.25s transform}
    .open-btn:hover{transform:translateY(-2px)}

    /* Layout */
    .wrap{max-width:1080px;margin:0 auto;padding:24px}
    .card{background:var(--card);backdrop-filter: blur(8px);border:1px solid #00000010;border-radius:20px;box-shadow:var(--shadow);padding:22px}
    .grid{display:grid;gap:18px}
    @media(min-width:900px){.grid-2{grid-template-columns:1.2fr .8fr}}

    header.hero{padding-top:72px}
    .names{font-size:clamp(26px,5.6vw,48px);font-weight:800;text-align:center}
    .date{color:#444;text-align:center;margin-top:6px}

    /* Countdown */
    .countdown{display:grid;grid-auto-flow:column;gap:10px;justify-content:center;margin:18px 0}
    .cell{background:#fff;border-radius:14px;padding:10px 14px;border:1px solid #00000014;min-width:68px;text-align:center}
    .cell .num{font-size:28px;font-weight:800}
    .cell .lbl{font-size:12px;color:#666}

    /* Sections */
    section{margin:26px 0}
    h2{font-size:clamp(20px,4vw,28px);margin:6px 0 12px}

    /* Info list */
    .info{display:grid;gap:10px}
    .info .row{display:flex;gap:12px;align-items:flex-start}
    .icon{width:24px;height:24px;flex:0 0 24px;opacity:.9}

    /* Map */
    .map{border-radius:16px;overflow:hidden;border:1px solid #00000018}
    .map iframe{width:100%;height:300px;border:0}

    /* Gallery */
    .gallery{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(min-width:720px){.gallery{grid-template-columns:repeat(4,1fr)}}
    .gallery img{border-radius:14px;aspect-ratio:1/1;object-fit:cover;border:1px solid #00000018}

    /* Lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:60}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:84vh;border-radius:12px}
    .lb-nav{position:fixed;inset:0;display:flex;align-items:center;justify-content:space-between;padding:24px;color:#fff}
    .lb-btn{background:#ffffff1a;border:1px solid #ffffff33;border-radius:12px;padding:10px 14px;cursor:pointer}

    /* Forms */
    form .field{display:grid;gap:6px;margin:10px 0}
    input, select, textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #00000022;background:#fff;font-size:14px}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#fff;padding:12px 16px;border-radius:14px;font-weight:700;cursor:pointer}
    .notes{font-size:12px;color:#666}

    .guestbook .item{background:#fff;border:1px solid #00000014;border-radius:14px;padding:12px;display:grid;gap:4px}
    .guestbook .meta{font-size:12px;color:#666}

    /* Floating FABs */
    .fab-col{position:fixed;right:16px;bottom:16px;display:grid;gap:10px;z-index:40}
    .fab{display:inline-grid;place-items:center;width:54px;height:54px;border-radius:999px;background:#fff;border:1px solid #00000022;box-shadow:var(--shadow);cursor:pointer}

    /* Reveal on scroll (lembut) */
    .reveal{opacity:0;transform:translateY(18px) scale(.98);transition:opacity .65s ease, transform .65s cubic-bezier(.22,.8,.24,1)}
    .reveal.show{opacity:1;transform:none}

    footer{padding:30px 0 60px;text-align:center;color:#666}
    .badge{display:inline-block;background:#fff;border:1px solid #00000014;border-radius:10px;padding:6px 10px;font-size:12px}

    /* Sponsor (multi, vertikal) */
    .sponsor{margin-top:14px;display:flex;flex-direction:column;align-items:center;gap:10px;color:#666}
    .sponsor-heading{font-size:12px}
    .sponsor-logos{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));
      gap:14px; width:100%; max-width:520px; justify-items:center;
    }
    .sponsor-item{display:flex;flex-direction:column;align-items:center;text-align:center}
    .sponsor-item img{height:34px;width:auto;opacity:.95}
    .sponsor-item .cap{font-size:11px;color:#888;margin-top:6px}

    /* === Portraits (dua foto â€“ stadium vertikal) === */
    .portraits .grid-portraits{
      display:grid;
      gap:28px;                 /* jarak default (mobile) */
      grid-template-columns:1fr;
    }
    @media(min-width:720px){
      .portraits .grid-portraits{
        grid-template-columns:1fr 1fr;
        column-gap:40px;        /* jarak antar bingkai priaâ€“wanita */
        row-gap:28px;
      }
    }
    .portrait-card{ display:grid; justify-items:center; gap:10px; text-align:center; }
    .portrait-frame{
      width:clamp(200px,48vw,320px);
      aspect-ratio:3/4;
      padding:2px;                 /* tebal ring: ubah ini */
      border:2px solid #d4af37;    /* warna ring: ubah ini */
      border-radius:9999px;        /* stadium vertikal: atas/bawah melengkung */
      overflow:hidden;
      background:#fff;
      box-shadow:var(--shadow);
    }
    .portrait-img{ width:100%; height:100%; object-fit:cover; border-radius:inherit; display:block; background:#00000008; }
    .portrait-name{ font-weight:700; }
    .portrait-sub{ font-size:12px; color:#666; }
  </style>
</head>
<body>
<!-- CONFIG: ubah data di sini -->
<script>
  const CONFIG = {
    title: "Contoh Undangan Pawiwahan",
    bride: "Sampek",
    groom: "Duik",
    parents: "Putra & putri Peradah Dusun Ujung Sari awokawokaowk",
    dateISO: "2025-09-05T10:00:00+08:00",
    dateText: "Minggu, 5 September 2025 â€¢ 10.00 WITA â€“ selesai",
    place: "Dusun Ujung Sari, Desa Subur",
    maps: "https://maps.app.goo.gl/S7hWjjKRmhS3vkGo6",
    whatsapp: "6282192698260",
    coverImage: "cover.jpg",
    gallery: ["foto1.jpg","foto2.jpg","foto3.jpg","foto4.jpg","foto5.jpg"],

    /* Musik YouTube (pakai ID/URL). Kosongkan "" bila ingin pakai musik.mp3 */
    youtube: "https://youtu.be/L2I7hZqC7lY?si=yAiNTx3aji-g6nfD",

    /* Sponsor */
    sponsorsHeading: "support by:",
    sponsors: [
      { logo: "sponsor1.png", name: "Super Grub", link: "" },
      { logo: "sponsor2.png", name: "Yaatra Studio", link: "" }
    ],

    /* === Potret mempelai (2 foto) === */
    portraits: {
      bride: { src: "potret-wanita.jpg", name: "Duik",   sub: "Putri pertama dari Pasangan......" },
      groom: { src: "potret-pria.jpg",   name: "Sampek", sub: "Putra pertama dari Pasangan....." }
    }
  };
  document.title = CONFIG.title;
</script>

  <!-- COVER / OPENING -->
  <div class="cover" id="cover">
    <div class="cover-inner">
      <div class="chip">Om Swastyastu â€¢ Manusa Yadnya</div>
      <div class="title">Pawiwahan / Pernikahan</div>
      <p class="subtitle">Ngaturang atur piuning, mugi rahayu. Klik tombol di bawah untuk membuka undangan.</p>
      <button class="open-btn" id="openInvite">Buka Undangan</button>
    </div>
  </div>

  <main class="wrap" id="app" style="display:none">
    <header class="hero reveal">
      <div class="card">
        <div class="names">{{BRIDE}} &amp; {{GROOM}}</div>
        <div class="date">{{PARENTS}}</div>
        <div class="countdown" id="countdown" aria-live="polite"></div>
        <p class="badge">{{DATETEXT}} â€¢ {{PLACE}}</p>
      </div>
    </header>

    <!-- === POTRET MEMPELAI (dua foto, stadium) === -->
    <section class="card reveal portraits" id="portraits">
      <h2>Potret Mempelai</h2>
      <div class="grid-portraits">
        <figure class="portrait-card">
          <div class="portrait-frame">
            <img id="portBride" class="portrait-img" alt="Potret mempelai wanita" />
          </div>
          <figcaption>
            <div class="portrait-name" id="portBrideName"></div>
            <div class="portrait-sub" id="portBrideSub"></div>
          </figcaption>
        </figure>
        <figure class="portrait-card">
          <div class="portrait-frame">
            <img id="portGroom" class="portrait-img" alt="Potret mempelai pria" />
          </div>
          <figcaption>
            <div class="portrait-name" id="portGroomName"></div>
            <div class="portrait-sub" id="portGroomSub"></div>
          </figcaption>
        </figure>
      </div>
    </section>

    <!-- WAKTU & TEMPAT -->
    <section class="reveal">
      <div class="card">
        <h2>Waktu & Tempat</h2>
        <div class="info">
          <div class="row">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg>
            <div><strong>Waktu</strong><div id="dateText">{{DATETEXT}}</div></div>
          </div>
          <div class="row">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 21s-7-5.2-7-10.2A7 7 0 0 1 19 10.8C19 15.8 12 21 12 21Z"/></svg>
            <div><strong>Lokasi</strong><div id="placeText"></div></div>
          </div>
          <div class="row">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
            <div>
              <strong>Tambahkan ke Kalender</strong>
              <div class="notes">Simpan pengingat ke kalender Anda (ICS).</div>
              <button class="primary" id="btnICS">Download .ics</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- GALERI -->
    <section class="card reveal">
      <h2>Galeri</h2>
      <div class="gallery" id="gallery"></div>
    </section>

    <!-- MAP (di bawah galeri) -->
    <section class="card reveal map">
      <iframe id="mapFrame" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div style="padding:10px 4px"><a id="mapLink" target="_blank" rel="noopener">Buka di Google Maps</a></div>
    </section>

    <!-- RSVP & BUKU TAMU -->
    <section class="grid grid-2">
      <div class="card reveal">
        <h2>Konfirmasi Kehadiran</h2>
        <form id="rsvp">
          <div class="field"><label>Nama</label><input required name="name" placeholder="Nama lengkap" /></div>
          <div class="field"><label>Status Kehadiran</label>
            <select name="status"><option value="Hadir">Hadir</option><option value="Tidak dapat hadir">Tidak dapat hadir</option></select>
          </div>
          <div class="field"><label>Jumlah Tamu</label><input type="number" name="count" value="1" min="1" /></div>
          <div class="field"><label>Ucapan (opsional)</label><textarea name="msg" rows="3" placeholder="Doa/ucapan singkat"></textarea></div>
          <button class="primary" type="submit">Kirim via WhatsApp</button>
          <p class="notes">Tombol akan membuka WhatsApp dengan format pesan otomatis.</p>
        </form>
      </div>
      <div class="card reveal">
        <h2>Buku Tamu</h2>
        <form id="guestForm">
          <div class="field"><label>Nama</label><input required name="n" placeholder="Nama"/></div>
          <div class="field"><label>Pesan</label><textarea required name="p" rows="3" placeholder="Tulis doa/ucapan"></textarea></div>
          <button class="primary" type="submit">Kirim</button>
        </form>
        <div class="notes" style="margin-top:8px">Disimpan secara lokal di perangkat Anda.</div>
        <div class="grid" style="margin-top:12px" id="guestList"></div>
      </div>
    </section>

    <section class="card reveal">
      <h2>Protokol & Catatan</h2>
      <ul>
        <li>Mohon datang tepat waktu sesuai jadwal upacara.</li>
        <li>Jaga ketertiban dan tetap menghormati jalannya upacara.</li>
        <li>Parkir kendaraan pada area yang telah disediakan.</li>
      </ul>
    </section>

    <footer class="reveal">
      <div style="font-size:18px">Matur Suksma</div>
      <div style="font-size:14px">Atas doa dan kehadiran semeton sami.</div>

      <!-- Sponsor -->
      <div class="sponsor" id="sponsorBlock">
        <div class="sponsor-heading" id="sponsorHeading"></div>
        <div class="sponsor-logos" id="sponsorLogos"></div>
      </div>
    </footer>
  </main>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <div class="lb-nav">
      <button class="lb-btn" id="lbPrev" aria-label="Sebelumnya">â—€</button>
      <button class="lb-btn" id="lbClose" aria-label="Tutup">âœ•</button>
      <button class="lb-btn" id="lbNext" aria-label="Berikutnya">â–¶</button>
    </div>
    <img id="lbImg" alt="Foto galeri" />
  </div>

  <!-- FABs -->
  <div class="fab-col" id="fabs" style="display:none">
    <button class="fab" id="btnMusic" aria-label="Musik latar">
      <svg id="iconPlay" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      <svg id="iconPause" viewBox="0 0 24 24" width="22" height="22" fill="currentColor" style="display:none"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>
    </button>
    <button class="fab" id="btnShare" aria-label="Bagikan">ðŸ”—</button>
  </div>

  <!-- Fallback audio -->
  <audio id="bgm" loop preload="none"><source src="musik.mp3" type="audio/mpeg" /></audio>

  <!-- YT hidden -->
  <div id="ytWrap" aria-hidden="true" style="position:fixed;left:-9999px;top:auto;width:1px;height:1px;opacity:0;pointer-events:none">
    <div id="ytPlayer"></div>
  </div>

  <script>
    const byId = (id)=>document.getElementById(id);
    const $$ = (sel,root=document)=>[...root.querySelectorAll(sel)];

    // Inject hero
    const hero = document.querySelector('header.hero .card');
    hero.innerHTML = hero.innerHTML
      .replaceAll('{{BRIDE}}', CONFIG.bride)
      .replaceAll('{{GROOM}}', CONFIG.groom)
      .replaceAll('{{PARENTS}}', CONFIG.parents)
      .replaceAll('{{DATETEXT}}', CONFIG.dateText)
      .replaceAll('{{PLACE}}', CONFIG.place);

    byId('dateText').textContent = CONFIG.dateText;
    const placeEl = byId('placeText'); if (placeEl) placeEl.textContent = CONFIG.place;

    // ==== Portraits inject ====
    (function(){
      const P = CONFIG.portraits || {};
      const s1 = P.bride?.src, s2 = P.groom?.src;
      const sec = byId('portraits');
      if(!s1 && !s2){ sec.style.display='none'; return; }

      if(s1){ byId('portBride').src = s1; }
      if(s2){ byId('portGroom').src = s2; }
      byId('portBrideName').textContent = P.bride?.name || CONFIG.bride;
      byId('portGroomName').textContent = P.groom?.name || CONFIG.groom;
      byId('portBrideSub').textContent  = P.bride?.sub || "";
      byId('portGroomSub').textContent  = P.groom?.sub || "";
    })();

    // ===== Sponsor block =====
    (function(){
      const headingEl = byId('sponsorHeading');
      const logosWrap = byId('sponsorLogos');
      const block     = byId('sponsorBlock');
      const list = Array.isArray(CONFIG.sponsors) ? CONFIG.sponsors : [];
      const hasAnything = (list.length > 0) || (CONFIG.sponsorsHeading && CONFIG.sponsorsHeading.trim() !== "");
      if (!hasAnything) { block.style.display = 'none'; return; }
      headingEl.textContent = CONFIG.sponsorsHeading || 'sponsored by:';
      list.forEach(it=>{
        if(!it || !it.logo) return;
        const item = document.createElement('div');
        item.className = 'sponsor-item';
        const img = document.createElement('img');
        img.alt = it.name || 'Sponsor'; img.src = it.logo; img.onerror = ()=>{ item.style.display='none'; };
        if (it.link) { const a=document.createElement('a'); a.href=it.link; a.target='_blank'; a.rel='noopener'; a.appendChild(img); item.appendChild(a); }
        else { item.appendChild(img); }
        if (it.name) { const cap=document.createElement('div'); cap.className='cap'; cap.textContent=it.name; item.appendChild(cap); }
        logosWrap.appendChild(item);
      });
    })();

    // Map embed
    const mapUrl = CONFIG.maps || "";
    const embed = (u)=>{
      try{
        if(u.includes("/embed")) return u;
        if(u.includes("maps.app.goo.gl") || u.trim()===""){ return "https://www.google.com/maps?q="+encodeURIComponent(CONFIG.place)+"&output=embed"; }
        if(u.includes("/@")) return u.replace("/@","/embed?pb=");
      }catch{}
      return "https://www.google.com/maps?q="+encodeURIComponent(CONFIG.place)+"&output=embed";
    };
    byId('mapFrame').src = embed(mapUrl);
    const mapLink = document.getElementById('mapLink');
    mapLink.href = mapUrl || ("https://www.google.com/maps?q="+encodeURIComponent(CONFIG.place));
    mapLink.textContent = CONFIG.place + ' â€” Lihat di Maps';

    // Gallery
    const g = document.getElementById('gallery');
    CONFIG.gallery.forEach((src,i)=>{
      const img=document.createElement('img'); img.src=src; img.alt='Galeri '+(i+1); img.loading='lazy';
      img.addEventListener('click',()=>openLightbox(i)); g.appendChild(img);
    });

    // ===== Scroll reveal (IntersectionObserver) =====
    function setupScrollReveal(){
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            e.target.classList.add('show');
            io.unobserve(e.target);
          }
        });
      }, { threshold: 0.15, rootMargin: '0px 0px -5% 0px' });

      document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
    }

    // Open / Cover
    const cover = byId('cover'), app = byId('app'), fabs = byId('fabs');

    // YT support
    function getYTId(input){ if(!input) return ""; const s=String(input).trim(); const m=s.match(/(?:v=|\.be\/|embed\/)([a-zA-Z0-9_-]{11})/); return m?.[1] || (/^[a-zA-Z0-9_-]{11}$/.test(s)?s:""); }
    const YT_ID = getYTId(CONFIG.youtube); const USE_YT = !!YT_ID;
    let ytPlayer=null, pendingPlay=false;
    window.onYouTubeIframeAPIReady = function(){
      if(!USE_YT) return;
      ytPlayer = new YT.Player('ytPlayer',{ videoId:YT_ID, playerVars:{autoplay:0,loop:1,playlist:YT_ID,controls:0,modestbranding:1,rel:0,fs:0,playsinline:1},
        events:{ onReady:()=>{ if(pendingPlay){ try{ytPlayer.playVideo();}catch{} pendingPlay=false; syncMusicBtn(); } } }});
    };

    const bgm = document.getElementById('bgm');
    const iconPlay = document.getElementById('iconPlay');
    const iconPause= document.getElementById('iconPause');
    function isMusicPlaying(){ return (USE_YT && ytPlayer?.getPlayerState)? (ytPlayer.getPlayerState()===YT.PlayerState.PLAYING) : !bgm.paused; }
    function syncMusicBtn(){ const p=isMusicPlaying(); iconPlay.style.display=p?'none':'block'; iconPause.style.display=p?'block':'none'; }

    document.getElementById('openInvite').addEventListener('click', ()=>{
      cover.style.display='none'; app.style.display='block'; fabs.style.display='grid';
      setupScrollReveal();     // aktifkan efek pop-in saat scroll
      startCountdown();
      if (USE_YT){ if(ytPlayer?.playVideo){ try{ytPlayer.playVideo();}catch{} } else { pendingPlay=true; } try{bgm.pause();}catch{} }
      else { try{bgm.play().then(()=>syncMusicBtn());}catch{} }
      syncMusicBtn();
    });

    document.getElementById('btnMusic').addEventListener('click', ()=>{
      if (USE_YT){ const st=ytPlayer?.getPlayerState?.(); if(st===YT.PlayerState.PLAYING) ytPlayer.pauseVideo(); else ytPlayer?.playVideo() ?? (pendingPlay=true); }
      else { if (bgm.paused) bgm.play(); else bgm.pause(); }
      syncMusicBtn();
    });

    // Countdown
    let timerId=null;
    function startCountdown(){
      const box=document.getElementById('countdown'); const t=new Date(CONFIG.dateISO).getTime();
      const labels=['Hari','Jam','Menit','Detik']; const cell=(v,l)=>`<div class="cell"><div class="num">${v}</div><div class="lbl">${l}</div></div>`;
      function tick(){ const now=Date.now(); let diff=Math.max(0,t-now); const d=Math.floor(diff/86400000); diff-=d*86400000; const h=Math.floor(diff/3600000); diff-=h*3600000; const m=Math.floor(diff/60000); diff-=m*60000; const s=Math.floor(diff/1000); box.innerHTML=[d,h,m,s].map((n,i)=>cell(String(n).padStart(2,'0'),labels[i])).join(''); }
      tick(); clearInterval(timerId); timerId=setInterval(tick,1000);
    }

    // Lightbox
    const lb=document.getElementById('lightbox'), lbImg=document.getElementById('lbImg'); let lbIndex=0;
    function openLightbox(i){ lbIndex=i; updateLB(); lb.classList.add('open'); } function closeLightbox(){ lb.classList.remove('open'); }
    function updateLB(){ lbImg.src=CONFIG.gallery[lbIndex]; }
    document.getElementById('lbPrev').onclick=()=>{ lbIndex=(lbIndex-1+CONFIG.gallery.length)%CONFIG.gallery.length; updateLB(); };
    document.getElementById('lbNext').onclick=()=>{ lbIndex=(lbIndex+1)%CONFIG.gallery.length; updateLB(); };
    document.getElementById('lbClose').onclick=closeLightbox;
    lb.addEventListener('click', e=>{ if(e.target===lb) closeLightbox(); });
    window.addEventListener('keydown', e=>{ if(!lb.classList.contains('open')) return; if(e.key==='Escape') closeLightbox(); if(e.key==='ArrowRight') document.getElementById('lbNext').click(); if(e.key==='ArrowLeft') document.getElementById('lbPrev').click(); });

    // RSVP -> WA
    document.getElementById('rsvp').addEventListener('submit', e=>{
      e.preventDefault(); const f=new FormData(e.target);
      const msg=`Halo, saya *${f.get('name')}*
Status: ${f.get('status')}
Jumlah: ${f.get('count')} orang
Ucapan: ${f.get('msg')||'-'}

Untuk acara Pawiwahan: ${CONFIG.bride} & ${CONFIG.groom} pada ${CONFIG.dateText} di ${CONFIG.place}.`;
      window.open(`https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
    });

    // Guestbook
    const LS_KEY='guestbook-mepandes'; const list=document.getElementById('guestList'); const entries=JSON.parse(localStorage.getItem(LS_KEY)||'[]');
    function renderGuest(){ list.innerHTML=''; entries.sort((a,b)=>b.t-a.t).forEach(it=>{ const d=document.createElement('div'); d.className='guestbook item'; d.innerHTML=`<div><strong>${escapeHTML(it.n)}</strong></div><div>${escapeHTML(it.p)}</div><div class='meta'>${new Date(it.t).toLocaleString('id-ID')}</div>`; list.appendChild(d); }); }
    renderGuest();
    document.getElementById('guestForm').addEventListener('submit', e=>{
      e.preventDefault(); const f=new FormData(e.target); const n=(f.get('n')||'').trim(); const p=(f.get('p')||'').trim(); if(!n||!p) return;
      entries.push({n,p,t:Date.now()}); localStorage.setItem(LS_KEY, JSON.stringify(entries)); e.target.reset(); renderGuest();
    });
    function escapeHTML(s){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

    // Share
    document.getElementById('btnShare').addEventListener('click', async ()=>{
      const shareData={title:CONFIG.title, text:`Undangan: ${CONFIG.bride} & ${CONFIG.groom} â€“ ${CONFIG.dateText}`, url:location.href};
      if(navigator.share){ try{ await navigator.share(shareData);}catch{} } else { await navigator.clipboard.writeText(shareData.url); alert('Link disalin ke clipboard'); }
    });

    // ICS
    document.getElementById('btnICS').addEventListener('click', ()=>{
      const dt=new Date(CONFIG.dateISO); const dtStart=toICSDate(dt); const dtEnd=toICSDate(new Date(dt.getTime()+3*60*60*1000));
      const ics=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Undangan Mepandes//ID
CALSCALE:GREGORIAN
BEGIN:VEVENT
DTSTAMP:${toICSDate(new Date())}
UID:${crypto.randomUUID()}
DTSTART:${dtStart}
DTEND:${dtEnd}
SUMMARY:Upacara Pawiwahan â€“ ${CONFIG.bride} & ${CONFIG.groom}
LOCATION:${escapeICS(CONFIG.place)}
DESCRIPTION:${escapeICS('Undangan Pawiwahan. Info: '+CONFIG.place)}
END:VEVENT
END:VCALENDAR`;
      const blob=new Blob([ics],{type:'text/calendar'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='undangan.ics'; a.click(); URL.revokeObjectURL(a.href);
    });
    function toICSDate(d){ const pad=n=>String(n).padStart(2,'0'); return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+'Z'; }
    function escapeICS(s){ return s.replace(/\\/g,'\\\\').replace(/;/g,'\\;').replace(/,/g,'\\,').replace(/\n/g,'\\n'); }
  </script>

  <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
