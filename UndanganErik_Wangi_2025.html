<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Undangan Mepandes – Cantika & Dekwah</title>
  <meta name="description" content="Undangan upacara Manusa Yadnya (Mepandes / Potong Gigi). Teriring doa dan welas asih, Om Swastyastu.">
  <meta property="og:title" content="Undangan Mepandes – Cantika & Dekwah" />
  <meta property="og:description" content="Ngaturang atur piuning, mugi rahayu. Klik untuk membuka undangan." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="" />
  <meta name="theme-color" content="#f7efe5" />
  <style>
    :root{
      --bg:#f7efe5; /* lembut krem */
      --ink:#2b2b2b;
      --accent:#ba7a2a; /* emas hangat */
      --accent-2:#e0b973;
      --card:#ffffffcc;
      --rose:#d46d6d;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}
    a{color:var(--accent);text-decoration:none}
    img{max-width:100%;display:block}

    /* Hero / Cover */
    .cover{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.55)), url('cover.jpg') center/cover no-repeat;z-index:50;color:#fff}
    .cover-inner{max-width:680px;text-align:center;padding:24px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #ffffff33;padding:6px 12px;border-radius:999px;font-size:14px;background:#ffffff1a;backdrop-filter: blur(6px)}
    .title{font-size:clamp(28px,6vw,56px);line-height:1.05;margin:16px 0 8px;font-weight:800;letter-spacing:0.5px}
    .subtitle{opacity:.9;font-size:clamp(14px,2.5vw,18px)}
    .open-btn{margin-top:22px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;border:none;border-radius:14px;padding:14px 22px;font-size:16px;cursor:pointer;box-shadow:var(--shadow);transition:.25s transform}
    .open-btn:hover{transform:translateY(-2px)}

    /* Floating flowers */
    .petal{position:fixed;pointer-events:none;top:-60px;filter:drop-shadow(0 6px 10px rgba(0,0,0,.15));opacity:.85}
    @keyframes fall{to{transform:translateY(120vh) rotate(360deg);opacity:.95}}

    /* Layout */
    .wrap{max-width:1080px;margin:0 auto;padding:24px}
    .card{background:var(--card);backdrop-filter: blur(8px);border:1px solid #00000010;border-radius:20px;box-shadow:var(--shadow);padding:22px}
    .grid{display:grid;gap:18px}
    @media(min-width:900px){.grid-2{grid-template-columns:1.2fr .8fr}}

    header.hero{padding-top:72px}
    .names{font-size:clamp(26px,5.6vw,48px);font-weight:800;text-align:center}
    .date{color:#444;text-align:center;margin-top:6px}

    /* Countdown */
    .countdown{display:grid;grid-auto-flow:column;gap:10px;justify-content:center;margin:18px 0}
    .cell{background:#fff;border-radius:14px;padding:10px 14px;border:1px solid #00000014;min-width:68px;text-align:center}
    .cell .num{font-size:28px;font-weight:800}
    .cell .lbl{font-size:12px;color:#666}

    /* Sections */
    section{margin:26px 0}
    h2{font-size:clamp(20px,4vw,28px);margin:6px 0 12px}

    /* Info list */
    .info{display:grid;gap:10px}
    .info .row{display:flex;gap:12px;align-items:flex-start}
    .icon{width:24px;height:24px;flex:0 0 24px;opacity:.9}

    /* Map */
    .map{border-radius:16px;overflow:hidden;border:1px solid #00000018}
    .map iframe{width:100%;height:280px;border:0}

    /* Gallery */
    .gallery{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(min-width:720px){.gallery{grid-template-columns:repeat(4,1fr)}}
    .gallery img{border-radius:14px;aspect-ratio:1/1;object-fit:cover;border:1px solid #00000018}

    /* Lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:60}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:84vh;border-radius:12px}
    .lb-nav{position:fixed;inset:0;display:flex;align-items:center;justify-content:space-between;padding:24px;color:#fff}
    .lb-btn{background:#ffffff1a;border:1px solid #ffffff33;border-radius:12px;padding:10px 14px;cursor:pointer}

    /* RSVP / Buku Tamu */
    form .field{display:grid;gap:6px;margin:10px 0}
    input, select, textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #00000022;background:#fff;font-size:14px}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#fff;padding:12px 16px;border-radius:14px;font-weight:700;cursor:pointer}
    .notes{font-size:12px;color:#666}

    .guestbook .item{background:#fff;border:1px solid #00000014;border-radius:14px;padding:12px;display:grid;gap:4px}
    .guestbook .meta{font-size:12px;color:#666}

    /* Music & Share floating */
    .fab-col{position:fixed;right:16px;bottom:16px;display:grid;gap:10px;z-index:40}
    .fab{display:inline-grid;place-items:center;width:54px;height:54px;border-radius:999px;background:#fff;border:1px solid #00000022;box-shadow:var(--shadow);cursor:pointer}

    /* Reveal on scroll */
    .reveal{opacity:0;transform:translateY(16px);transition: .6s ease}
    .reveal.show{opacity:1;transform:none}

    footer{padding:30px 0 60px;text-align:center;color:#666}

    /* Small badge */
    .badge{display:inline-block;background:#fff;border:1px solid #00000014;border-radius:10px;padding:6px 10px;font-size:12px}

  </style>
</head>
<body>
  <!-- CONFIG: ubah data di sini -->
  <script>
    const CONFIG = {
      title: "Undangan Mepandes – Cantika & Dekwah",
      bride: "Putu Ayu Masyoni Cantikadewi",
      groom: "I Kadek Wahyu Hanggara Putra",
      parents: "Putra & putri dari Bpk. I Nyoman Kerca & Ibu Ni Wayan Ika Purnawati Nugraha",
      dateISO: "2025-10-01T11:00:00+08:00", // format ISO, WITA = +08:00
      dateText: "Rabu, 1 Oktober 2025 • 11.00 WITA – selesai",
      place: "Banjar Buwitan, Batubulan",
      maps: "https://maps.google.com/?q=Banjar%20Buwitan%20Batubulan",
      whatsapp: "6281234567890", // ganti dengan nomor WA panitia
      coverImage: "cover.jpg",
      gallery: ["galeri-1.jpg","galeri-2.jpg","galeri-3.jpg","galeri-4.jpg","galeri-5.jpg","galeri-6.jpg"],
    };
    document.title = CONFIG.title;
  </script>

  <!-- COVER / OPENING -->
  <div class="cover" id="cover">
    <div class="cover-inner">
      <div class="chip">Om Swastyastu • Manusa Yadnya</div>
      <div class="title">Mepandes / Potong Gigi</div>
      <p class="subtitle">Ngaturang atur piuning, mugi rahayu. Klik tombol di bawah untuk membuka undangan.</p>
      <button class="open-btn" id="openInvite">Buka Undangan</button>
    </div>
  </div>

  <!-- Floating petals (dynamically inserted) -->

  <main class="wrap" id="app" style="display:none">
    <header class="hero reveal">
      <div class="card">
        <div class="names">{{BRIDE}} &amp; {{GROOM}}</div>
        <div class="date">{{PARENTS}}</div>
        <div class="countdown" id="countdown" aria-live="polite"></div>
        <p class="badge">{{DATETEXT}} • {{PLACE}}</p>
      </div>
    </header>

    <section class="grid grid-2">
      <div class="card reveal">
        <h2>Waktu & Tempat</h2>
        <div class="info">
          <div class="row"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg>
            <div><strong>Waktu</strong><div id="dateText">{{DATETEXT}}</div></div>
          </div>
          <div class="row"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 21s-7-5.2-7-10.2A7 7 0 0 1 19 10.8C19 15.8 12 21 12 21Z"/></svg>
            <div><strong>Lokasi</strong><div>{{PLACE}}</div></div>
          </div>
          <div class="row"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
            <div>
              <strong>Tambahkan ke Kalender</strong>
              <div class="notes">Simpan pengingat ke kalender Anda (ICS).</div>
              <button class="primary" id="btnICS">Download .ics</button>
            </div>
          </div>
        </div>
      </div>
      <div class="card reveal map">
        <iframe id="mapFrame" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
        <div style="padding:10px 4px"><a id="mapLink" target="_blank" rel="noopener">Buka di Google Maps</a></div>
      </div>
    </section>

    <section class="card reveal">
      <h2>Galeri</h2>
      <div class="gallery" id="gallery"></div>
    </section>

    <section class="grid grid-2">
      <div class="card reveal">
        <h2>Konfirmasi Kehadiran</h2>
        <form id="rsvp">
          <div class="field">
            <label>Nama</label>
            <input required name="name" placeholder="Nama lengkap" />
          </div>
          <div class="field">
            <label>Status Kehadiran</label>
            <select name="status">
              <option value="Hadir">Hadir</option>
              <option value="Tidak dapat hadir">Tidak dapat hadir</option>
            </select>
          </div>
          <div class="field">
            <label>Jumlah Tamu</label>
            <input type="number" name="count" value="1" min="1" />
          </div>
          <div class="field">
            <label>Ucapan (opsional)</label>
            <textarea name="msg" rows="3" placeholder="Doa/ucapan singkat"></textarea>
          </div>
          <button class="primary" type="submit">Kirim via WhatsApp</button>
          <p class="notes">Tombol akan membuka WhatsApp dengan format pesan otomatis.</p>
        </form>
      </div>
      <div class="card reveal">
        <h2>Buku Tamu</h2>
        <form id="guestForm">
          <div class="field"><label>Nama</label><input required name="n" placeholder="Nama"/></div>
          <div class="field"><label>Pesan</label><textarea required name="p" rows="3" placeholder="Tulis doa/ucapan" ></textarea></div>
          <button class="primary" type="submit">Kirim</button>
        </form>
        <div class="notes" style="margin-top:8px">Disimpan secara lokal di perangkat Anda.</div>
        <div class="grid" style="margin-top:12px" id="guestList"></div>
      </div>
    </section>

    <section class="card reveal">
      <h2>Protokol & Catatan</h2>
      <ul>
        <li>Mohon datang tepat waktu sesuai jadwal upacara.</li>
        <li>Jaga ketertiban dan tetap menghormati jalannya upacara.</li>
        <li>Parkir kendaraan pada area yang telah disediakan.</li>
      </ul>
    </section>

    <footer class="reveal">
      <div style="font-size:18px">Matur Suksma</div>
      <div style="font-size:14px">Atas doa dan kehadiran semeton sami.</div>
    </footer>
  </main>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <div class="lb-nav">
      <button class="lb-btn" id="lbPrev" aria-label="Sebelumnya">◀</button>
      <button class="lb-btn" id="lbClose" aria-label="Tutup">✕</button>
      <button class="lb-btn" id="lbNext" aria-label="Berikutnya">▶</button>
    </div>
    <img id="lbImg" alt="Foto galeri" />
  </div>

  <!-- FLOATING ACTIONS: music + share -->
  <div class="fab-col" id="fabs" style="display:none">
    <button class="fab" id="btnMusic" aria-label="Musik latar">
      <!-- play icon -->
      <svg id="iconPlay" viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      <svg id="iconPause" viewBox="0 0 24 24" width="22" height="22" fill="currentColor" style="display:none"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>
    </button>
    <button class="fab" id="btnShare" aria-label="Bagikan">🔗</button>
  </div>

  <audio id="bgm" loop preload="none">
    <!-- Ganti file musik Anda -->
    <source src="musik.mp3" type="audio/mpeg" />
  </audio>

  <script>
    // ===== Helper & Setup =====
    const byId = (id)=>document.getElementById(id);
    const $ = (sel,root=document)=>root.querySelector(sel);
    const $$ = (sel,root=document)=>[...root.querySelectorAll(sel)];

    // Inject dynamic text
    const hero = document.querySelector('header.hero .card');
    hero.innerHTML = hero.innerHTML
      .replace('{{BRIDE}}', CONFIG.bride)
      .replace('{{GROOM}}', CONFIG.groom)
      .replace('{{PARENTS}}', CONFIG.parents)
      .replaceAll('{{DATETEXT}}', CONFIG.dateText)
      .replace('{{PLACE}}', CONFIG.place);

    byId('dateText').textContent = CONFIG.dateText;
    const mapUrl = CONFIG.maps;
    byId('mapFrame').src = mapUrl.replace('/@','/embed?pb='); // best-effort; if fails still fine
    byId('mapLink').href = mapUrl;
    byId('mapLink').textContent = CONFIG.place + ' — Lihat di Maps';

    // Populate gallery
    const g = byId('gallery');
    CONFIG.gallery.forEach((src,i)=>{
      const img = document.createElement('img');
      img.src = src; img.alt = 'Galeri '+(i+1);
      img.loading = 'lazy';
      img.addEventListener('click',()=>openLightbox(i));
      g.appendChild(img);
    });

    // ===== Open / Cover =====
    const cover = byId('cover');
    const app = byId('app');
    const fabs = byId('fabs');
    const openBtn = byId('openInvite');
    openBtn.addEventListener('click', ()=>{
      cover.style.display='none';
      app.style.display='block';
      fabs.style.display='grid';
      startCountdown();
      spawnPetals();
      // Auto play music (user gesture from click)
      try{byId('bgm').play().then(()=>syncMusicBtn());}catch{ /* ignore */ }
    });

    // ===== Falling petals =====
    function spawnPetals(){
      for(let i=0;i<16;i++){
        const p=document.createElement('img');
        p.src = toDataURIFlower();
        p.className='petal';
        const d = 8 + Math.random()*14; // duration
        p.style.left = (Math.random()*100)+'vw';
        p.style.animation = `fall ${d}s linear ${Math.random()*-d}s infinite`;
        p.style.width = (26+Math.random()*16)+'px';
        document.body.appendChild(p);
      }
    }
    function toDataURIFlower(){
      // tiny inline SVG of frangipani-ish petal
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'>
        <defs><radialGradient id='g' cx='50%' cy='50%' r='50%'><stop offset='0%' stop-color='#fff8e1'/><stop offset='100%' stop-color='#ffd27a'/></radialGradient></defs>
        <g fill='url(#g)' stroke='#e9b35f' stroke-width='1'>
          <path d='M32 6c5 9 9 15 20 18-8 2-11 4-14 12-3-8-6-10-14-12 11-3 15-9 20-18Z'/>
        </g></svg>`;
      return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
    }

    // ===== Countdown =====
    let timerId=null; 
    function startCountdown(){
      const box = byId('countdown');
      const t = new Date(CONFIG.dateISO).getTime();
      const labels=['Hari','Jam','Menit','Detik'];
      const makeCell = (v,l)=>`<div class="cell"><div class="num">${v}</div><div class="lbl">${l}</div></div>`;
      function tick(){
        const now = Date.now();
        let diff = Math.max(0, t - now);
        const d = Math.floor(diff/86400000); diff -= d*86400000;
        const h = Math.floor(diff/3600000); diff -= h*3600000;
        const m = Math.floor(diff/60000); diff -= m*60000;
        const s = Math.floor(diff/1000);
        box.innerHTML = [d,h,m,s].map((n,i)=>makeCell(String(n).padStart(2,'0'), labels[i])).join('');
      }
      tick();
      clearInterval(timerId); timerId = setInterval(tick,1000);
    }

    // ===== Lightbox =====
    const lb = byId('lightbox');
    const lbImg = byId('lbImg');
    let lbIndex = 0;
    function openLightbox(i){ lbIndex=i; updateLB(); lb.classList.add('open'); }
    function closeLightbox(){ lb.classList.remove('open'); }
    function updateLB(){ lbImg.src = CONFIG.gallery[lbIndex]; }
    byId('lbPrev').onclick=()=>{ lbIndex = (lbIndex - 1 + CONFIG.gallery.length) % CONFIG.gallery.length; updateLB(); };
    byId('lbNext').onclick=()=>{ lbIndex = (lbIndex + 1) % CONFIG.gallery.length; updateLB(); };
    byId('lbClose').onclick=closeLightbox;
    lb.addEventListener('click', e=>{ if(e.target===lb) closeLightbox(); });
    window.addEventListener('keydown', e=>{ if(!lb.classList.contains('open')) return; if(e.key==='Escape') closeLightbox(); if(e.key==='ArrowRight') byId('lbNext').click(); if(e.key==='ArrowLeft') byId('lbPrev').click(); });

    // ===== RSVP -> WhatsApp =====
    byId('rsvp').addEventListener('submit', e=>{
      e.preventDefault();
      const f = new FormData(e.target);
      const msg = `Halo, saya *${f.get('name')}*\nStatus: ${f.get('status')}\nJumlah: ${f.get('count')} orang\nUcapan: ${f.get('msg')||'-'}\n\nUntuk acara Mepandes: ${CONFIG.bride} & ${CONFIG.groom} pada ${CONFIG.dateText} di ${CONFIG.place}.`;
      const url = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
    });

    // ===== Guestbook (LocalStorage) =====
    const LS_KEY='guestbook-mepandes';
    const list = byId('guestList');
    const entries = JSON.parse(localStorage.getItem(LS_KEY)||'[]');
    function renderGuest(){
      list.innerHTML='';
      entries.sort((a,b)=>b.t-a.t).forEach((it,idx)=>{
        const div=document.createElement('div');
        div.className='guestbook item';
        div.innerHTML=`<div><strong>${escapeHTML(it.n)}</strong></div>
                       <div>${escapeHTML(it.p)}</div>
                       <div class='meta'>${new Date(it.t).toLocaleString('id-ID')}</div>`;
        list.appendChild(div);
      });
    }
    renderGuest();
    byId('guestForm').addEventListener('submit', e=>{
      e.preventDefault();
      const f = new FormData(e.target);
      const n = (f.get('n')||'').trim();
      const p = (f.get('p')||'').trim();
      if(!n||!p) return;
      entries.push({n,p,t:Date.now()});
      localStorage.setItem(LS_KEY, JSON.stringify(entries));
      e.target.reset();
      renderGuest();
    });
    function escapeHTML(s){return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));}

    // ===== Share & Music =====
    const bgm = byId('bgm');
    const iconPlay = byId('iconPlay');
    const iconPause = byId('iconPause');
    function syncMusicBtn(){
      const isPlaying = !bgm.paused;
      iconPlay.style.display = isPlaying ? 'none':'block';
      iconPause.style.display = isPlaying ? 'block':'none';
    }
    byId('btnMusic').addEventListener('click', ()=>{ if(bgm.paused) bgm.play(); else bgm.pause(); syncMusicBtn(); });
    bgm.addEventListener('ended', syncMusicBtn);

    byId('btnShare').addEventListener('click', async ()=>{
      const shareData = { title: CONFIG.title, text: `Undangan: ${CONFIG.bride} & ${CONFIG.groom} – ${CONFIG.dateText}`, url: location.href };
      if(navigator.share){ try{ await navigator.share(shareData);}catch{} }
      else{
        await navigator.clipboard.writeText(shareData.url);
        alert('Link disalin ke clipboard');
      }
    });

    // ===== Add to Calendar (ICS) =====
    byId('btnICS').addEventListener('click', ()=>{
      const dt = new Date(CONFIG.dateISO);
      const dtStart = toICSDate(dt);
      const dtEnd = toICSDate(new Date(dt.getTime()+3*60*60*1000)); // default 3 jam
      const ics = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Undangan Mepandes//ID\nCALSCALE:GREGORIAN\nBEGIN:VEVENT\nDTSTAMP:${toICSDate(new Date())}\nUID:${crypto.randomUUID()}\nDTSTART:${dtStart}\nDTEND:${dtEnd}\nSUMMARY:Upacara Mepandes – ${CONFIG.bride} & ${CONFIG.groom}\nLOCATION:${escapeICS(CONFIG.place)}\nDESCRIPTION:${escapeICS('Undangan Mepandes. Info: '+CONFIG.place)}\nEND:VEVENT\nEND:VCALENDAR`;
      const blob = new Blob([ics],{type:'text/calendar'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'undangan-mepandes.ics';
      a.click();
      URL.revokeObjectURL(a.href);
    });
    function toICSDate(d){
      const pad=n=>String(n).padStart(2,'0');
      return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+'Z';
    }
    function escapeICS(s){return s.replace(/[\\;,\n]/g, m=>({"\\":"\\\\",";":"\\;",",":["\\,\n"],"\n":"\\n"}[m]));}

    // ===== Reveal on scroll =====
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target);} });
    }, {threshold:.12});
    $$('.reveal').forEach(el=>io.observe(el));

  </script>
</body>
</html>
